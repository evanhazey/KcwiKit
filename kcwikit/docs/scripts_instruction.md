# Command Line Scripts

Here is a list of command line tools offered by this package, and their functionalities. 

## kcrm_create_crmsk

```bash
kcrm_create_crmsk filename [-l [LABEL [LABEL ...]]] [--base_dir BASE_DIR] [--redux_dir REDUX_DIR] 
```
This script runs the median cosmic ray rejection and creates the FITS CR masks for each frame.
- `filename` - the input `json` file containing the grouping of frames generated by the `kcrm_group_frames` script. 
- `-l --label` - one or multiple label names in the grouping `json` file of which the CR masks are created. If no label is specified, all labels are created. 
- `--base_dir` - directory to which the raw frames are stored. Default is `./`.
- `--redux_dir` - diretory to which the redux directory is created by the DRP. Default is `./redux`.

## kcrm_group_frames

```bash
kcrm_group_frames logfile outfile [-c] [-d] [-i] [--redux_dir REDUX_DIR]
```
This script groups the individual frames based on the target names, PA, instrument setup, and exposure times. This grouping is stored in a `json` file to be used for cosmic ray rejction. 
- `logfile` - the `csv` file generated by `kcwi_gen_log`, containing the header information for all the frames. 
- `outfile` - the file name of the output `json` file. 
- `-c --continuous` - split non-continuous files into seperate groups. 
- `-d --display` - print out the grouping.
- `-i --int` - check if the `*_int.fits` exists in the `redux` directory
- `--redux_dir` - location of the redux directory created by the DRP. Default is `./redux`

## kcwi_collapse

```bash
kcwi_collapse file [file ...] [--wavebin WAVEBIN WAVEBIN] [--usepix]
```
Create white-light image from data cube(s). 
- `file` - file name(s) to be acted on. 
- `--wavebin` - the lower and upper wavelength limits in Angstrom.
- `--usepix` - change the unit of the previous `wavebin` parameter to pixel index. 

## kcwi_combinestd

```bash
kcwi_combinestd listfile [--noplot]
```
Combining a series of inverse sensitivity curves generated from multiple standard stars or standard star exposures. Often used to achieve higher accuracy (~3.5%) in flux calibration. 
- `listfile` - an ASCII list containing the absolute path and the full file names of the `invsens` files generated by the DRP or `KSkyWizard`. 
- `--noplot` - avoid creating the bokeh figure. 

## kcwi_flatten_cube

```bash
kcwi_flatten_cube file [file ...] [-r] [-m] [-t]
```
Flatten or de-flatten a FITS cube. Created from `kcwi_flatten_cube.pro` in the IDL DRP.
- `file` - file name(s) of the FITS cubes. 
- `-r --reverse` - reverse the flattening, i.e., building a cube from the 2D flattened image
- `-m --mask` - conduct the flattening or deflattening on a mask cube. 
- `-t --trim` - the amount pixels to be trimmed on top and bottom of the cube. 

## kcwi_gen_log
```bash
kcwi_gen_log outfile -f [FILENAME [FILENAME ...]] [-r] [-b] [-d]
```
Generate a `csv` file containing the important header information of FITS files. 
- `outfile` - name of the output file
- '-f --filename' - name(s) of the FITS files
- '-r --RED' - only perform on the red channel data
- '-b --BLUE' - only perform on the blue channel data
- '-d --display' - print the table

## kcwi_makemask_medfilter
```bash
kcwi_makemask_medfilter [dir] [-d]
```
Generate FITS masks from then DS9 region files for median filtering only. This script is a wrapper for `kcwi_masksky_ds9_thum` and `kcwi_masksky_ds9_2d`. 
- `dir` - diretory of which all `*.thum.reg` and `*_icube_2d.reg` will be converted. Default is `./`.
- `-d --cubed` - act on `cubed` files. 



